var prepdata=[],pdata=[],solvedsoluton="",sumcache=[],eset=10,load_sums_wait=0,calculationsPerformed=!1;function toLower(t){return t.toLowerCase()}function ucfirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}function numberWithCommas(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function checkAndFixExp(t){return t=t.toString().replace(/,/g,""),t=Math.abs(parseInt(t,10))}function createAlert(t,e){var a="",n="";switch(t){case"error":a="fa-solid fa-circle-radiation",n="danger";break;case"warn":case"warning":a="fa-solid fa-triangle-exclamation",n="warning";break;case"success":a="fa-solid fa-circle-check",n="success";break;case"info":a="fa fa-info-circle",n="info";break;case"none":a="";break;default:return void console.error("Invalid alert type:",t)}var s='<div class="alert alert-'+n+" alert-white rounded mt-2 border border-"+n+' p-1" role="alert" id="checkboxInfo"><div class="icon"><i class="'+a+'"></i></div><div class="text d-flex align-items-center"><b>'+e+"</b></div></div>";removeAlert(),$("#aside").prepend(s)}function removeAlert(){$("#aside .alert").length&&$("#aside .alert").remove()}function calcTotals(){var t=0;$.each($("#battletable .btitem .total"),(function(){t+=$(this).data("num")})),$("#bttotal").text(numberWithCommas(t)).data("num",t),$("#entryform input:first-of-type").trigger("change")}function findPossibleCombo(){var t=$("#exp2target").data("num");for(strat=1,solvedsoluton=solution="";strat;)switch(strat){case 1:for(var e=loadTrainers4Calc(10,5e4),a=0;t>e[9]&&void 0!==e[a];)if(t>=e[a]){if(t-e[a]<1500){a++;continue}solution=solution+"+"+e[a],t-=e[a]}else a++;void 0!==prepdata[t]?(solution=solution+"+"+prepdata[t],t=0,strat=0):strat=2;break;case 2:if(t>(e=loadTrainers4Calc(10,t))[e.length-1])for(var n=0;n<e.length;n++)if(t>=e[n]){var s=t-e[n];if(void 0!==prepdata[s]){solution=solution+"+"+e[n]+"+"+prepdata[s],t=t-e[n]-s;break}}strat=0}0==t?(solvedsoluton=solution,$("#loadsolution").fadeIn()):(console.log("No Solution"),solvedsoluton="",$("#loadsolution").fadeOut())}function loadSolution(){var t=solvedsoluton.split("+").filter(Boolean);$("#loadsolution").html('<img src="images/game/loading.gif" alt="Loading..." width="40"> Calculating...'),setTimeout((function(){for(var e=0;e<t.length;e++){var a=findTrainerByExp(t[e]);addBattleEntry(a.id,a.opp,a["exp"+eset],a.head,a.btid,a.base)}calcTotals(),$("#loadsolution").fadeOut(),removeAlert(),$("#battletable").fadeIn()}),1500)}function loadTrainers4Calc(t,e){var a=[];(a=pdata).sort((function(t,e){return e["exp"+eset]-t["exp"+eset]}));var n=0,s=[];return a.forEach((function(a,i){n>=t||a["exp"+eset]<=e&&(s.push(a["exp"+eset]),n++)})),s}function findTrainerByExp(t){for(var e=[],a=0;a<pdata.length;a++)if(pdata[a]["exp"+eset]==t){e=pdata[a];break}return e.id=$(".battler-2 b").filter((function(t){return $(this).text()===e.opp})).closest(".battler-2").attr("id").substring(4),e}function addBattleEntry(t,e,a,n,s,i){if($("#bt_"+t).length){var o=1*$("#bt_"+t+" .battles").text()+1;$("#bt_"+t+" .battles").text(o),$("#bt_"+t+" .total").data("num",o*a).text(numberWithCommas(o*a))}else{var r;r='<tr class="btitem bg-'+toLower(n)+'" id="bt_'+t+'"><td class="name" style="text-align:left; font-size:12px; text-transform: uppercase;"> <a href="#" id="toptionid" style="color: red;"><i class="fa fa-solid fa-bars"></i></a>&nbsp;&nbsp;&nbsp'+e+" ("+n.replace(/-/g," ")+')</td><td class="battles" style="text-align:center">1</td><td class="exp" data-num="'+a+'" style="text-align:center">'+numberWithCommas(a)+'</td><td class="total" data-num="'+a+'" style="text-align:center">'+numberWithCommas(a)+'</td><td class="" style="text-align:center">'+getButtonsHtml(i,s)+"</td></tr>",$("#battletable").append(r),$("#bt_"+t+" #toptionid").on("click",(function(t){t.preventDefault(),toptionid()}))}}function getButtonsHtml(t,e){switch(t){case"gym":return'<button id="gym" class="btn btn-primary btn-sm btn-action" style="--bs-btn-padding-y: .2rem; --bs-btn-padding-x: .8rem; --bs-btn-font-size: .75rem;" onclick="window.open(\''+(mainLink+"/battle/gym/"+e)+"', '_blank');\"><i class=\"fa-brands fa-battle-net\"></i> BATTLE!</button>";case"trainer":return'<div class="btn-group btn-group-sm" role="group"><button id="normal" class="btn btn-primary btn-sm btn-action" style="--bs-btn-padding-y: .1rem; --bs-btn-padding-x: .6rem; --bs-btn-font-size: .75rem;" onclick="redirectBattle(\'trainer\', '+e+', false);"><i class="fa-brands fa-battle-net"></i> NORMAL</button><button id="inverse" class="btn btn-dark btn-sm btn-action" style="--bs-btn-padding-y: .2rem; --bs-btn-padding-x: .5rem; --bs-btn-font-size: .75rem;" onclick="redirectBattle(\'trainer\', '+e+', true);"><i class="fa-solid fa-shuffle"></i> INVERSE</button></div>';case"pokemon":return'<button id ="maps" class="btn btn-primary btn-sm btn-action" style="--bs-btn-padding-y: .2rem; --bs-btn-padding-x: .8rem; --bs-btn-font-size: .75rem;" onclick="window.open(\''+(mainLink+"/home#maps")+"', '_blank');\"><i class=\"fa-solid fa-map-location-dot\"></i> GO TO MAPS</button>";case"training":return'<button id="training" class="btn btn-primary btn-sm btn-action" style="--bs-btn-padding-y: .2rem; --bs-btn-padding-x: .8rem; --bs-btn-font-size: .75rem;" data-bs-toggle="modal" data-bs-target="#train"><i class="fa-brands fa-battle-net"></i> BATTLE!</button>';default:return""}}function redirectBattle(t,e,a){var n=a?mainLink+"/battle/"+t+"/"+e+"/inverse":mainLink+"/battle/"+t+"/"+e;window.open(n,"_blank")}function ucfirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}function toLower(t){return void 0===t?"":t.toLowerCase()}function performExpCalculations(){$("#exp2target").data("num")>0&&findPossibleCombo()}function load_sums(t){load_sums_wait?setTimeout((function(){load_sums(t)}),2e3):eset in sumcache?(prepdata=sumcache[eset],solvedsoluton="",reload_exps(),t&&t(),performExpCalculations()):(load_sums_wait=1,$.getJSON("data/load_sums/sums_sub"+eset+".json?v=20190919",(function(e){prepdata=e;for(var a=0;a<pdata.length;a++)void 0!==pdata[a]["exp"+eset]&&(prepdata[pdata[a]["exp"+eset]]=pdata[a]["exp"+eset]);sumcache[eset]=prepdata,load_sums_wait=0,solvedsoluton="",reload_exps(),t&&t(),performExpCalculations()})))}function reload_exps(){dataset=$(".row").data("dataset"),dataset!=eset&&($(".row .battler-2").each((function(){newexp=$(this).data("exp"+eset),$(this).find(".exp").text(numberWithCommas(newexp))})),$(".row").data("dataset",eset))}$(document).ready((function(){$.getJSON("data/expdata.json",(function(t){t.forEach((function(t,e){pdata.push({opp:t.opp,exp10:t.e10,exp50:t.e50,exp100:t.e100,exp150:t.e150,head:t.head,btid:t.btid,base:t.base})})),pdata.sort((function(t,e){return e.exp10-t.exp10})),pdata.forEach((function(t,e){void 0!==t.opp&&$(".row").append('<div class="col-6 p-1"><div id="batt'+e+'" class="border battler-2 bg-'+toLower(t.head)+'" data-exp10="'+t.exp10+'" data-exp50="'+t.exp50+'" data-exp100="'+t.exp100+'" data-exp150="'+t.exp150+'" data-opp="'+t.opp+'" data-head="'+toLower(t.head)+'" data-btid="'+t.btid+'" data-base="'+t.base+'"><div class="d-flex"><div class="d-inline w-100 bg-menu" style="padding:3px;"><b style="font-size: 13px;">'+t.opp+'</b><div style="font-size: 9px; font-weight: bold;"><span style="font-size: 8px; font-weight: bold;">('+t.head.replace(/-/g," ").toUpperCase()+')</span></div></div></div><div class="mb-0 px-1 bg-light"><b>EXP:  <span class="exp">'+numberWithCommas(t.exp10)+'</span></b></span></b> <span class="float-end"> <small>ID#'+t.btid+'</small></span></div></div><div class="mt-1"><div class="list-group list-group-horizontal text-center"><a href="" class="list-group-item list-group-item-action p-1 bg-default viewinfo" data-battid="batt'+e+'"><i class="fa-solid fa-users-rectangle"></i> View</a><div id="batt'+e+'" class="list-group-item list-group-item-action p-1  battler" data-exp10="'+t.exp10+'" data-exp50="'+t.exp50+'" data-exp100="'+t.exp100+'" data-exp150="'+t.exp150+'" data-opp="'+t.opp+'" data-head="'+toLower(t.head)+'" data-btid="'+t.btid+'" data-base="'+t.base+'"><i class="fa-solid fa-user-plus"></i> EXPs</div></div></div></div>')})),$(".row").data("dataset",eset),load_sums((function(){$("#exp2target").data("num")>0&&findPossibleCombo()})),$(document).on("click",".viewinfo",(function(t){t.preventDefault();var e,a=$(this).data("battid"),n=$("#"+a),s=n.data("base"),i=n.data("btid");if("gym"===s)e=mainLink+"npc/"+i+"/gym";else if("pokemon"===s)e=mainLink+"home#maps";else if("trainer"===s)e=mainLink+"npc/"+i;else{if("training"===s)return void $("#train").modal("show");e=""}window.open(e,"_blank")}))})),$(document).on("click",".battler",(function(t){calculationsPerformed&&($("#battletable").is(":visible")||0===$("#exp2target").data("num")||(addBattleEntry($(this).attr("id").substring(4),$(this).data("opp"),$(this).data("exp"+eset),$(this).data("head"),$(this).data("btid"),$(this).data("base")),calcTotals()))})),$(document).on("click",".btclose .close",(function(t){var e=$(this).closest("tr.btitem"),a=e.find(".battles").text();if(a>1){a-=1;var n=e.find(".exp").data("num");e.find(".battles").text(a),e.find(".total").data("num",a*n).text(numberWithCommas(a*n))}else e.remove();calcTotals()})),$(document).on("click","#clearsol",(function(t){$("#battletable tbody tr").remove(),$("#battletable").fadeOut(),calcTotals()})),$("#entryform input").on("change",(function(){$("#expcalcinfo").fadeOut(),$(".expcalc-side").fadeIn(),$("#txteffect-2 strong").html('<img src="images/base/menu-profile.webp" width="18" alt="">&nbsp;&nbsp;LIST OF GYM LEADERS AND TRAINERS');var t=checkAndFixExp($("#currentExp").val()),e=checkAndFixExp($("#targetExp").val()),a=checkAndFixExp($("#bttotal").data("num"));if(0!=t&&0!=e)if(e<t)createAlert("error","Current Exp appears to be higher than Target Exp");else if(t<1e5||e<1e5)createAlert("error","This calculator only works for pokemon that are lvl 100");else if(e==t)createAlert("success","You are already at the Target Exp!");else if(e-t-a<4&&e-t-a>0)createAlert("warning","It is not possible to obtain less than 4 exp from a battle!");else{for(expsets=[10,50,100,150],error=0,i=0;i<=expsets.length;i++)if(expset=expsets[i],t<1e6*expset&&e>1e6*expset){createAlert("warning","Exp received is different when your Pokemon has less than "+numberWithCommas(1e6*expset)+" exp from when it has more.This calculator will not work in such a situation. Try getting your exp above this threshold and Try Again."),error=1;break}if(!error){for(i=0;i<=expsets.length;i++)if(t<1e6*expsets[i]){eset=expsets[i],load_sums();break}removeAlert();var n=e-t-a;$("#exp2target").text(numberWithCommas(n)).data("num",n),!$.isEmptyObject(pdata)&&!$.isEmptyObject(prepdata)&&n>=29&&findPossibleCombo(),calculationsPerformed=!0}}else removeAlert()})),$('[data-toggle="tooltip"]').tooltip(),$(document).on("click","#loadsolution",(function(t){$("#targetbox").css("color","black"),loadSolution()}))})),$(".infoEC").click((function(){$("#expcalcinfo").fadeIn(),$(".expcalc-side").fadeOut(),$("#txteffect-2 strong").html('<img src="images/base/info.webp" width="18" alt="">&nbsp;&nbsp;TODAY\'S TRAINER INFORMATION')})),load_sums();